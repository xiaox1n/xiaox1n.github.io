<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Android capability 01(性能优化) | 码农小阿新</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android capability 01(性能优化)</h1><a id="logo" href="/.">码农小阿新</a><p class="description">Talk is cheap. Show me the code!</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 历史</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android capability 01(性能优化)</h1><div class="post-meta">Dec 31, 2016<span> | </span><span class="category"><a href="/categories/capability/">capability</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>android 性能主要之响应速度和UI刷新速度。首先从函数的耗时来说，有一个工具TraceView 这是androidsdk自带的工作，用于测量函数耗时的。UI布局的分析，可以有2块，一块就是Hierarchy Viewer 可以看到View的布局层次，以及每个View刷新加载的时间。这样可以很快定位到那块layout &amp; View 耗时最长。还有就是通过自定义View来减少view的层次。</p>
<h2 id="Android-Capability-01-布局优化"><a href="#Android-Capability-01-布局优化" class="headerlink" title="Android Capability 01(布局优化)"></a>Android Capability 01(布局优化)</h2><h3 id="1、抽象布局标签"><a href="#1、抽象布局标签" class="headerlink" title="1、抽象布局标签"></a>1、抽象布局标签</h3><p>1).<include>标签<br>include标签常用于将布局中的公共部分提取出来供其他layout共用，以实现布局模块化。</include></p>
<p>2).<viewstub>标签<br>viewstub标签同include标签一样可以用来引入一个外部布局，不同的是，viewstub引入的布局默认不会扩张，即既不会占用显示也不会占用位置，从而在解析layout时节省cpu和内存。</viewstub></p>
<p>3).<merge>标签<br>在使用了include后可能导致布局嵌套过多，多余不必要的layout节点，从而导致解析变慢，不必要的节点和嵌套可通过hierarchy viewer(下面布局调优工具中有具体介绍)或设置-&gt;开发者选项-&gt;显示布局边界查看。</merge></p>
<ul>
<li>布局顶结点是FrameLayout且不需要设置background或padding等属性，可以用merge代替，因为Activity内容试图的parent view就是个FrameLayout，所以可以用merge消除只剩一个。</li>
<li>某布局作为子布局被其他布局include时，使用merge当作该布局的顶节点，这样在被引入时顶结点会自动被忽略，而将其子节点全部合并到主布局中。</li>
</ul>
<h3 id="2、去除不必要的嵌套和View节点"><a href="#2、去除不必要的嵌套和View节点" class="headerlink" title="2、去除不必要的嵌套和View节点"></a>2、去除不必要的嵌套和View节点</h3><ul>
<li>首次不需要使用的节点设置为GONE或使用viewstub</li>
<li>使用RelativeLayout代替LinearLayout，在4.0之后默认使用布局改为RelativeLayou，性能更优，且可以简单实现LinearLayout嵌套才能实现的布局</li>
</ul>
<h3 id="3、减少不必要的infalte"><a href="#3、减少不必要的infalte" class="headerlink" title="3、减少不必要的infalte"></a>3、减少不必要的infalte</h3><ul>
<li>对于inflate的布局可以直接缓存，用全部变量代替局部变量，避免下次需再次inflate</li>
<li>ListView提供了item缓存，adapter getView的标准写法，如下：</li>
</ul>
<h2 id="Android-Capability-02-代码优化"><a href="#Android-Capability-02-代码优化" class="headerlink" title="Android Capability 02(代码优化)"></a>Android Capability 02(代码优化)</h2><h3 id="1、缓存"><a href="#1、缓存" class="headerlink" title="1、缓存"></a>1、缓存</h3><p>缓存主要包括对象缓存、IO缓存、网络缓存、DB缓存，对象缓存能减少内存的分配，IO缓存减少磁盘的读写次数，网络缓存减少网络传输，DB缓存较少Database的访问次数。在内存、文件、数据库、网络的读写速度中，内存都是最优的，且速度数量级差别，所以尽量将需要频繁访问或访问一次消耗较大的数据存储在缓存中。</p>
<p>Android中常见缓存：</p>
<ul>
<li>线程池</li>
<li>Android图片缓存，Android图片Sdcard缓存，数据预取缓存</li>
<li><p>消息缓存(<br>通过handler.obtainMessage复用之前的message，如下：<br>handler.sendMessage(handler.obtainMessage(0, object));)</p>
</li>
<li><p>ListView缓存</p>
</li>
<li>网络缓存( 数据库缓存http response，根据http头信息中的Cache-Control域确定缓存过期时间。)</li>
<li>文件IO缓存 ( 使用具有缓存策略的输入流，BufferedInputStream替代InputStream，BufferedReader替代Reader，BufferedReader替代BufferedInputStream.对文件、网络IO皆适用。)</li>
<li>layout缓存</li>
<li>其他需要频繁访问或访问一次消耗较大的数据缓存</li>
</ul>
<h3 id="2、数据存储优化"><a href="#2、数据存储优化" class="headerlink" title="2、数据存储优化"></a>2、数据存储优化</h3><ul>
<li><p>数据类型选择</p>
<blockquote>
<p>字符串拼接用StringBuilder代替String，在非并发情况下用StringBuilder代替StringBuffer。如果你对字符串的长度有大致了解，如100字符左右，可以直接new StringBuilder(128)指定初始大小，减少空间不够时的再次分配。<br>64位类型如long double的处理比32位如int慢<br>使用SoftReference、WeakReference相对正常的强应用来说更有利于系统垃圾回收<br>final类型存储在常量区中读取效率更高<br>LocalBroadcastManager代替普通BroadcastReceiver，效率和安全性都更高</p>
</blockquote>
</li>
<li><p>数据结构选择</p>
<blockquote>
<p>常见的数据结构选择如：<br>ArrayList和LinkedList的选择，ArrayList根据index取值更快，LinkedList更占内存、随机插入删除更快速、扩容效率更高。一般推荐ArrayList。<br>ArrayList、HashMap、LinkedHashMap、HashSet的选择，hash系列数据结构查询速度更优，ArrayList存储有序元素，HashMap为键值对数据结构，LinkedHashMap可以记住加入次序的hashMap，HashSet不允许重复元素。<br>HashMap、WeakHashMap选择，WeakHashMap中元素可在适当时候被系统垃圾回收器自动回收，所以适合在内存紧张型中使用。<br>Collections.synchronizedMap和ConcurrentHashMap的选择，ConcurrentHashMap为细分锁，锁粒度更小，并发性能更优。Collections.synchronizedMap为对象锁，自己添加函数进行锁控制更方便。</p>
</blockquote>
</li>
</ul>
<p>Android也提供了一些性能更优的数据类型，如SparseArray、SparseBooleanArray、SparseIntArray、Pair。<br>Sparse系列的数据结构是为key为int情况的特殊处理，采用二分查找及简单的数组存储，加上不需要泛型转换的开销，相对Map来说性能更优。不过我不太明白为啥默认的容量大小是10，是做过数据统计吗，还是说现在的内存优化不需要考虑这些东西，写16会死吗，还是建议大家根据自己可能的容量设置初始值</p>
<h3 id="3、算法优化"><a href="#3、算法优化" class="headerlink" title="3、算法优化"></a>3、算法优化</h3><p>这个主题比较大，需要具体问题具体分析，尽量不用O(n*n)时间复杂度以上的算法，必要时候可用空间换时间。<br>查询考虑hash和二分，尽量不用递归。可以从结构之法 算法之道或微软、Google等面试题学习。</p>
<h4 id="4、提前初始化"><a href="#4、提前初始化" class="headerlink" title="4、提前初始化"></a>4、提前初始化</h4><p>一些需要耗时的操作可以提前初始化，Application中尽量减少初始化，会影响App启动速度</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/12/31/android-capability/" data-id="cixd1ef5f00008gvqp0texj9j" class="article-share-link">分享到</a><div class="tags"><a href="/tags/capability/">capability</a></div><div class="post-nav"><a href="/2016/12/31/android-interview-question/" class="next">Android Interview Question</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/architecture/">architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/capability/">capability</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/interview/">interview</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tips/">tips</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/interview/" style="font-size: 15px;">interview</a> <a href="/tags/basic/" style="font-size: 15px;">basic</a> <a href="/tags/resume/" style="font-size: 15px;">resume</a> <a href="/tags/capability/" style="font-size: 15px;">capability</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/31/android-capability/">Android capability 01(性能优化)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/31/android-interview-question/">Android Interview Question</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/29/resume-xiaox1n-dev/">周金龙求职简历</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/29/as-setup2/">Android Studio setup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/29/architecture-basic/">你拥有它，让Android开发更简单</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/meikoz" title="Github" target="_blank">Github</a><ul></ul><a href="https://gold.xitu.io/user/56eac9bdb0146000293a233b" title="掘金" target="_blank">掘金</a><ul></ul><a href="http://www.jianshu.com/users/50d56a1c64bf/latest_articles" title="简书" target="_blank">简书</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">码农小阿新.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>